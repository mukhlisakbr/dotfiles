# ===========================================
# Core Setup
# ===========================================

# oh-my-zsh
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME=""
plugins=(git)
source "$ZSH/oh-my-zsh.sh"

# zinit
source /opt/homebrew/opt/zinit/zinit.zsh
zinit light zsh-users/zsh-autosuggestions
zinit light zsh-users/zsh-syntax-highlighting
zinit light jessarcher/zsh-artisan
zinit cdreplay -q

# starship
eval "$(starship init zsh)"

# ===========================================
# Base Environment
# ===========================================

export EDITOR='nvim'
export TZ='Asia/Jakarta'

# ===========================================
# Tools
# ===========================================

# eza
export EZA_CONFIG_DIR="$HOME/.config/eza"
alias eza="eza --icons --sort=type"
alias l="eza"
alias ll="eza -l"
alias lla="eza -la"

# git
alias lg="lazygit"
alias wip='git add . && git commit -m "wip" && git push'

# sublime
export PATH="/Applications/Sublime Text.app/Contents/SharedSupport/bin:$PATH"

# antigravity
export PATH="$HOME/.antigravity/antigravity/bin:$PATH"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

# android
export ANDROID_HOME="/opt/homebrew/share/android-commandlinetools"
export ANDROID_SDK_ROOT="$ANDROID_HOME"
export PATH="$ANDROID_HOME/platform-tools:$PATH"
export PATH="$ANDROID_HOME/emulator:$PATH"
alias emu='emulator -avd Pixel_8_API_36'

# herd
export HERD_PHP_84_INI_SCAN_DIR="$HOME/Library/Application Support/Herd/config/php/84/"
export PATH="$HOME/Library/Application Support/Herd/bin:$PATH"

# claude
CLAUDE_CMD="claude --mcp-config ~/.claude/mcp.json"
alias cc="$CLAUDE_CMD"
alias ccd="$CLAUDE_CMD --dangerously-skip-permissions"
alias ccc="$CLAUDE_CMD -c"

# opencode
alias oc="opencode"

# ===========================================
# Tool Initializations
# ===========================================

# zoxide
eval "$(zoxide init zsh)"

# fzf
FD_BASE="fd --strip-cwd-prefix"
FZF_PREVIEW_WINDOW="--preview-window=60%:wrap"
FZF_PREVIEW_BIND="--bind=ctrl-d:preview-page-down,ctrl-u:preview-page-up"

export FZF_DEFAULT_COMMAND="$FD_BASE --type f"
export FZF_DEFAULT_OPTS=" \
  --color=bg+:#313244,bg:#1E1E2E,spinner:#F5E0DC,hl:#F38BA8 \
  --color=fg:#CDD6F4,header:#F38BA8,info:#CBA6F7,pointer:#F5E0DC \
  --color=marker:#B4BEFE,fg+:#CDD6F4,prompt:#CBA6F7,hl+:#F38BA8 \
  --color=selected-bg:#45475A \
  --color=border:#6C7086,label:#CDD6F4"

export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_CTRL_T_OPTS="--preview='bat -n --color=always {}' $FZF_PREVIEW_WINDOW $FZF_PREVIEW_BIND"

export FZF_ALT_C_COMMAND="$FD_BASE --type d"
export FZF_ALT_C_OPTS="--preview='tree -C {} | head -200' $FZF_PREVIEW_WINDOW $FZF_PREVIEW_BIND"

source <(fzf --zsh)

# mise
eval "$(mise activate zsh)"

# ===========================================
# Functions
# ===========================================

# yazi - cd on exit
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}
