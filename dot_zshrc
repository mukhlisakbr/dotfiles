# Oh My Zsh init
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME=""
plugins=()
source $ZSH/oh-my-zsh.sh

# Zinit plugin manager
source /opt/homebrew/opt/zinit/zinit.zsh
zinit light zsh-users/zsh-autosuggestions
zinit light zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-completions
zinit snippet OMZP::git

# Starship prompt
eval "$(starship init zsh)"

# Zoxide init
eval "$(zoxide init zsh)"

# mise version manager
eval "$(mise activate zsh)"

# Bun Bin & Completions
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"
eval "$(bun completions)"

# PNPM Bin & Completions
export PNPM_HOME="/Users/ghost/Library/pnpm"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac
eval "$(pnpm completion zsh)"

# HERD & PHP
export HERD_PHP_84_INI_SCAN_DIR="/Users/ghost/Library/Application Support/Herd/config/php/84/"
export PATH="/Users/ghost/Library/Application Support/Herd/bin/:$PATH"

# ngrok completions
if command -v ngrok &>/dev/null; then
  eval "$(ngrok completion)"
fi

# FZF + FD integration
FD_BASE="fd --strip-cwd-prefix"
export FZF_DEFAULT_COMMAND="$FD_BASE --type f"
export FZF_CTRL_T_COMMAND="$FD_BASE --type f"
export FZF_ALT_C_COMMAND="$FD_BASE --type d"
export FZF_CTRL_T_OPTS="--preview 'bat -n --color=always {}'"
export FZF_ALT_C_OPTS="--preview 'tree -C {} | head -200'"
source <(fzf --zsh)

# Eza config & aliases
export EZA_CONFIG_DIR="$HOME/.config/eza"
alias eza="eza --icons --sort=type"
alias l="eza"
alias ll="eza -l"
alias lla="eza -la"

# Common CLI Aliases
alias lg="lazygit"
alias ld="lazydocker"
alias pn="pnpm"

# Git WIP Commit alias
alias wip='git add . && git commit -m "wip" && git push'

# Terminal and Editor Settings
export TERM=xterm-256color
export EDITOR='vim'

# Sublime Text bin
export PATH="/Applications/Sublime Text.app/Contents/SharedSupport/bin:$PATH"

# Java Home
export JAVA_HOME=/Library/Java/JavaVirtualMachines/zulu-17.jdk/Contents/Home

# Android SDK
export ANDROID_HOME=$HOME/library/android/sdk
export ANDROID_NDK_HOME=$ANDROID_HOME/ndk/27.1.12297006
export PATH="$PATH:$ANDROID_HOME/emulator"
export PATH="$PATH:$ANDROID_HOME/platform-tools"
export PATH="$PATH:$ANDROID_HOME/build-tools/35.0.0"

# XDG Config Home
export XDG_CONFIG_HOME="$HOME/.config"

# Yazi with cd
y() {
  local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
  yazi "$@" --cwd-file="$tmp"
  if cwd="$(command cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
    builtin cd -- "$cwd"
  fi
  rm -f -- "$tmp"
}
